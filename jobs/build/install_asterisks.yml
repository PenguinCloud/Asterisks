---
- name: Download Asterisks
  ansible.builtin.get_url:
    url: "{{ asterisk.link }}"
    dest: /opt

- name: Extract Asterisks
  unarchive:
    src: "/opt/{{ asterisk.version }}.tar.gz"
    dest: /opt

- name: Delete Asterisk zip file
  file:
    path: "/opt/{{ asterisk.version }}.tar.gz"
    state: absent

- name: Rename Asterisk repo
  shell: "mv /opt/{{ asterisk.ver }} /opt/asterisk"

- name: Install mp3 required dependencies
  shell:
    chdir: /opt/asterisk/contrib/scripts
    cmd: |
      ./get_mp3_source.sh

- name: Install required dependencies
  ansible.builtin.expect:
    chdir: /opt/asterisk/contrib/scripts
    command: ./install_prereq install
    timeout: 180
    responses:
      (?i)ITU-T telephone code: "{{ itut }}"

- name: Configure Asterisk
  shell:
    chdir: /opt/asterisk
    cmd: ./configure

- name: Configure Asterisk
  shell:
    chdir: /opt/asterisk
    cmd: ./configure

- name: Run command enable core sound module
  shell:
    chdir: /opt/asterisk
    cmd: |
      menuselect/menuselect --enable-category MENUSELECT_CORE_SOUNDS menuselect.makeopts

- name: Run command enable MOH module
  shell:
    chdir: /opt/asterisk
    cmd: |
      menuselect/menuselect --enable-category MENUSELECT_MOH menuselect.makeopts

- name: Run command enable extra sound module
  shell:
    chdir: /opt/asterisk
    cmd: |
      menuselect/menuselect --enable-category MENUSELECT_EXTRA_SOUNDS menuselect.makeopts

- name: Build Asterisk
  shell:
    chdir: /opt/asterisk
    cmd: make -j2

- name: Build Asterisk
  shell:
    chdir: /opt/asterisk
    cmd: make install

- name: Install samples and configs
  shell:
    chdir: /opt/asterisk
    cmd: |
      make samples
      make config
      ldconfig